<!doctype html>
<html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>docker-stream</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="docker-stream">
  <link rel="apple-touch-icon" href="/s/img/bot2.png">
  <link rel="icon" sizes="196x196" href="/s/img/bot2.png">
  <link rel="shortcut icon" type="image/png" href="/s/img/bot2.png">
  <link rel="manifest" href="/s/manifest.json">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css">

</head><body>
<style>

body {
  padding: 10px;
  font-size: 0.8em;
}

.ctn {
  height: 24px;
  max-width: 24px;
  border: 1px white solid;
  background-color: #dadada;
  padding-left: 0.5rem !important;
  padding-right: 0.5rem !important;
  padding-top: 0.5rem !important;
  padding-bottom: 0.5rem !important;
}

div.status-running,
div.status-exec_start,
div.status-start {
  background-color: #00BCD4;
}

div.status-exec_create,
div.status-create {
  background-color: #cddc39;
}

div.status-stop,
div.status-die,
div.status-kill,
div.status-exited {
  background-color: #e91e63;
}

div.status-destroy {
  background-color: #ff9800;
}

</style>

<div class="main container"></div>

<script src="https://thbkrkr.github.io/s.js/dist/s.11.ef9e3d2.zm.js"></script>
<script>

$ws('/ws?topic='+($param('topic') || 'thbkrkr.miaou'),
  function onopen() {},
  function onclose(time) {},
  function onmessage(event) {
    try {
      event = JSON.parse(event.data)
    } catch (e) {
      return
    }
    if (!event || !event.Host) return

    host = event.Host
    hostId = host.replace(/\./g, '-')
    hostElem = document.getElementById(hostId)
    status = event.Status.split(':')[0]
    clazz = `column ctn status-${status}`
    title = `status=${status} name=${event.Name} image=${event.Image}`
    ctnElem = document.getElementById(event.ID)

    // Add host
    if (!hostElem) {
      $('.main').append(`
        <div class="host">${host} - <span id="count-${hostId}">0</span></div>
        <div id="${hostId}" class="ui aligned padded grid">
        </div>`)
    }

    countElem = $(`#count-${hostId}`)

    // Remove destroyed ctn
    if (ctnElem && status == 'destroy') {
      countElem.html(countElem.html()*1-1)
      $(ctnElem).remove()
      return
    }

    // Add ctn
    if (!ctnElem) {
      countElem.html(countElem.html()*1+1)
      $(hostElem).append(`<div id="${event.ID}"  class="${clazz}" title="${title}"></div>`)
    }
    else {
      // Update ctn
      $(ctnElem).attr('title', title)
      $(ctnElem).attr('class', clazz)
    }
  }
)

</script></body>
</html>
